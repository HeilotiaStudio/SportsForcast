<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Euro Cup Simulation</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
<style>
  body { background-color: #101820; color: white; font-family: Arial, sans-serif; padding:20px; }
  .calendar-day { border:1px solid #fff; padding:8px; margin:5px 0; border-radius:6px; background:#1f1f1f; }
  .team { display:flex; align-items:center; gap:5px; }
  .flag { width:24px; height:16px; border:1px solid #ccc; }
  .champion { color: lime; font-weight:bold; font-size:1.5rem; margin-bottom:15px; }
  .ot { color: orange; }
  .home { font-weight:bold; }
  .tweak-panel { border:1px solid #fff; padding:10px; border-radius:6px; margin-bottom:15px; background:#222; }
  input[type=number] { width:60px; margin-right:5px; }
  .button { margin:5px; padding:8px 15px; font-size:16px; background:orange; border:none; border-radius:8px; color:white; cursor:pointer; }
  .legend { border:1px solid #fff; border-radius:6px; padding:10px; margin-bottom:15px; background:#222; }
  .legend-item { margin:5px 0; }
</style>
</head>
<body>

<div id="app">

  <div class="tweak-panel">
    <h4>Adjust Coefficients / Chances</h4>
    <label>Home Boost:</label>
    <input type="number" step="0.01" v-model.number="config.HOME_BOOST" /><br/>
    <label>OT Weak-Strong:</label>
    <input type="number" step="0.01" v-model.number="config.OT_CHANCES['weak-strong']" /><br/>
    <label>OT Medium-Weak:</label>
    <input type="number" step="0.01" v-model.number="config.OT_CHANCES['medium-weak']" /><br/>
    <label>OT Same Strength:</label>
    <input type="number" step="0.01" v-model.number="config.OT_CHANCES['same-strength']" />
  </div>

  <div class="legend" v-if="allPickedCountries.length">
    <h4>Teams Legend</h4>
    <div class="legend-item" v-for="team in allPickedCountries" :key="team.name">
      {{ team.name }} ‚Äî Strength: {{ team.strength }} ‚Äî <span :class="{home:isHome(team.name)}">{{ isHome(team.name)?'Home':'Away' }}</span>
    </div>
  </div>

  <button class="button" @click="runSimulation">Run Simulation</button>
  <button class="button" @click="downloadJSON">Download JSON</button>

  <div v-if="results">
    <div class="champion">üèÜ Champion: {{ results.champion.name }}</div>

    <div v-for="(group,data) in results.groups" :key="group">
      <h3>{{ group }}</h3>
      <div v-for="(match,idx) in data.matches" :key="idx" class="calendar-day" :class="{ot:match.wentOT}">
        <div class="team">
          <span :class="{home: isHome(match.team1)}">{{ match.team1 }} {{ match.goals1 }}</span> -
          <span :class="{home: isHome(match.team2)}">{{ match.goals2 }} {{ match.team2 }}</span>
        </div>
      </div>
      <p>Standings:</p>
      <ul>
        <li v-for="t in data.table">{{ t.name }} - {{ t.points }} pts ({{ t.goalsFor }}:{{ t.goalsAgainst }})</li>
      </ul>
    </div>

    <div>
      <h3>Knockouts</h3>
      <div v-for="(r,ri) in results.knockouts" :key="ri">
        <h4>{{ r.round }}</h4>
        <div v-for="(m,mi) in r.matches" :key="mi" class="calendar-day" :class="{ot:m.wentOT}">
          <div class="team">
            <span :class="{home: isHome(m.team1)}">{{ m.team1 }} {{ m.goals1 }}</span> -
            <span :class="{home: isHome(m.team2)}">{{ m.goals2 }} {{ m.team2 }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
const app = Vue.createApp({
  data() {
    return {
      config: {
        HOME_BOOST: 0.1,
        OT_CHANCES: { "weak-strong": 0.1, "medium-weak": 0.35, "same-strength": 0.5 }
      },
      results: null,
      allPickedCountries: JSON.parse(localStorage.getItem("allPickedCountries")) || []
    }
  },
  methods: {
    isHome(teamName){
      const home = JSON.parse(localStorage.getItem('homeCountries')) || [];
      return home.includes(teamName);
    },
    randomChoice(arr){ return arr[Math.floor(Math.random()*arr.length)]; },
    simulateMatch(team1, team2){
      const strengthMap = { weak:1, medium:2, strong:3 };
      const t1Str = strengthMap[team1.strength]||2;
      const t2Str = strengthMap[team2.strength]||2;
      const homeBoost = this.isHome(team1.name)? this.config.HOME_BOOST : 0;
      let t1Weight = t1Str + homeBoost;
      let t2Weight = t2Str;
      const baseGoals = ()=>Math.floor(Math.random()*3);
      let goals1 = baseGoals()+t1Weight;
      let goals2 = baseGoals()+t2Weight;
      let wentOT=false;
      if(Math.round(goals1)===Math.round(goals2)){
        wentOT=true;
        let key = t1Str===t2Str ? "same-strength" : t1Str>t2Str ? "strong-weak":"weak-strong";
        const chance = this.config.OT_CHANCES[key]||0.25;
        if(Math.random()<chance){ Math.random()<0.5?goals1+=1:goals2+=1; }
      }
      goals1=Math.round(goals1); goals2=Math.round(goals2);
      let winner = goals1>goals2? team1.name : goals2>goals1? team2.name : "Draw";
      return { team1:team1.name, team2:team2.name, goals1, goals2, winner, wentOT };
    },
    computeGroupStandings(teams){
      const table = teams.map(t=>({...t, points:0, goalsFor:0, goalsAgainst:0}));
      const results=[];
      for(let i=0;i<teams.length;i++){
        for(let j=i+1;j<teams.length;j++){
          const match = this.simulateMatch(table[i], table[j]);
          results.push(match);
          table[i].goalsFor+=match.goals1; table[i].goalsAgainst+=match.goals2;
          table[j].goalsFor+=match.goals2; table[j].goalsAgainst+=match.goals1;
          if(match.winner===table[i].name) table[i].points+=3;
          else if(match.winner===table[j].name) table[j].points+=3;
          else { table[i].points+=1; table[j].points+=1; }
        }
      }
      table.sort((a,b)=> b.points!==a.points? b.points-a.points : (b.goalsFor-b.goalsAgainst)-(a.goalsFor-a.goalsAgainst));
      return { table, results };
    },
    simulateKnockouts(teams){
      let rounds=[], current=teams.slice();
      const roundNames=["Quarterfinals","Semifinals","Final"];
      let idx=0;
      while(current.length>1){
        const round={round:roundNames[idx]||`Round ${idx+1}`, matches:[]};
        for(let i=0;i<current.length;i+=2){
          const match=this.simulateMatch(current[i],current[i+1]);
          round.matches.push(match);
        }
        rounds.push(round);
        current=round.matches.map((m,i)=> m.winner==="Draw"? this.randomChoice([current[i*2],current[i*2+1]]) : m.winner)
                        .map(w=> teams.find(t=>t.name===w));
        idx++;
      }
      return rounds;
    },
    runSimulation(){
      if(this.allPickedCountries.length!==16){ alert("16 countries needed in 4 groups."); return; }

      const groups={
        "Group A": this.allPickedCountries.slice(0,4),
        "Group B": this.allPickedCountries.slice(4,8),
        "Group C": this.allPickedCountries.slice(8,12),
        "Group D": this.allPickedCountries.slice(12,16)
      };
      let groupResults={}, qualified=[];
      for(const [gName, teams] of Object.entries(groups)){
        const { table, results } = this.computeGroupStandings(teams);
        groupResults[gName]={ table, matches:results };
        qualified.push(...table.slice(0,2));
      }

      const knockouts = this.simulateKnockouts(qualified);
      const champName = knockouts[knockouts.length-1].matches[0].winner;
      const championObj = this.allPickedCountries.find(t=>t.name===champName);
      const simResults = { groups: groupResults, knockouts, champion: championObj };
      localStorage.setItem("simulationResults", JSON.stringify(simResults,null,2));
      this.results = simResults;
    },
    downloadJSON(){
      if(!this.results){ alert("Run simulation first."); return; }
      const dataStr = "data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.results,null,2));
      const link=document.createElement("a");
      link.setAttribute("href",dataStr);
      link.setAttribute("download","simulationResults.json");
      document.body.appendChild(link);
      link.click();
      link.remove();
    }
  }
});
app.mount('#app');
</script>

</body>
</html>




